## fram_gamev2.0.1版技术分析

#### 杨天朝

### 初始化

1. 在view_sence_main.js中实例化出：主界面，邻居界面，相册界面，日志界面，背包商城界面的prefabs，将它们的active设为false，屏蔽层开启

2. 加载各种数据

3. 在login接口获得数据

   判断是不是**会员**

   true：游戏主界面节点打开

   false：弹出弹框，提示“您不是会员，请购买会员后重试！”

### 游戏主界面

1. 在游戏主界面接口获取土地数据，并加载数据到用户农场

   ```json
   "useid": 10001,
   "vip": 0,
   "grandid":-1,
   "token":"",
   "grandinfo":{
   "dapengid":"",
   "name":"",
   "operates":[]
   "other":{},
   "items":[
   {
   "是否种植":0,
   "作物ID":0,
   "level":0
   ```

2. 微信头像，需要一个url，将URL显示，我的相册、日志两个按钮，点击打开相应的节点

3. 判断**grandid**

   -1：购买土地节点打开

    0：用户农场打开

4. 购买土地

​         加载土地图片。点击购买按钮，写入日志，购买土地节点打开。

   5.用户农场

​         （1）根据数据里面的 ’ **grandinfo** ‘ 更新土地信息显示，根据数据里面的 ’**items**‘ 更新八块土地状态  

​          （2）八块土地实现：打算用八个sprite的button实现，父节点是一张大的可以左右拖动的sprite，用户点击土地快，显示出要种的作物，种下，返回后台这块地种下了此种作物

​          （3）浇水、除草等道具数量刷新，分为四种状态，例如：浇水时候不能进行其他操作。点击浇水，向服务器发送浇水操作请求，返回使用成功时，浇水次数减1，并写入日志。

​          （4）商城、背包、邻居三个按钮，对应三个节点的点击事件

6. 邻居信息节点

      （1）在邻居接口获取数据：

   ```json
    {
           "userinfo":{
               "name":"",
               "url":"",
               "userid":""
           },
           "grandinfo":{
           "dapengid":"",
           "name":"",
           "operates":[]
           "other":{},
           "items":[
           {
           "是否种植":0,
           "作物ID":0,
           "level":0
           }
           ]
     }
   ```

​           （2）UI 使用tableviews，初始化11个，显示10个信息，当下滑时候第十一个显示，第一个变成第十一个，点击进入button，进入邻居农场界面。网络请求：成功刷新列表数据，失败抛出信息，重新获取

7. 邻居土地

​          （1）根据数据里面的 ’ **grandinfo** ‘ 更新土地信息显示，根据数据里面的 ’**items**‘ 更新八块土地状态  

​          （2）八块土地实现：打算用八个sprite的button实现，父节点是一张大的可以左右拖动的sprite

​          （3）上一页，下一页按钮制作，按钮事件是在邻居信息节点的脚本里面，点击下一页刷新为下一位邻居信息







